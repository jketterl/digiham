cmake_minimum_required (VERSION 3.0)
project (digiham VERSION 0.4.0)

SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${PROJECT_SOURCE_DIR}/cmake/")

find_package(LibMbe REQUIRED)

add_library(fec STATIC ysf/trellis.c dmr/quadratic_residue.c dmr/hamming_16_11.c dmr/hamming_7_4.c ysf/golay_24_12.c ysf/crc16.c dmr/golay_20_8.c dmr/hamming_15_11.c dmr/hamming_13_9.c dmr/bptc_196_96.c pocsag/bch_31_21.c)
add_library(version STATIC version.c)
add_library(ysf STATIC ysf/fich.c ysf/whitening.c ysf/gps.c ysf/radio_types.c)
add_library(hamming_distance STATIC hamming_distance.c)
add_library(dumphex STATIC dumphex.c)

add_executable(rrc_filter rrc_filter.c)
target_link_libraries(rrc_filter version)
add_executable(dc_block dc_block.c)
target_link_libraries(dc_block version)
add_executable(gfsk_demodulator gfsk_demodulator.c)
target_link_libraries(gfsk_demodulator version)
add_executable(dmr_decoder dmr_decoder.c)
target_link_libraries(dmr_decoder version fec hamming_distance dumphex)
add_executable(ysf_decoder ysf_decoder.c)
target_link_libraries(ysf_decoder fec ysf version hamming_distance)
add_executable(mbe_synthesizer mbe_synthesizer.c)
target_include_directories(mbe_synthesizer PRIVATE ${LIBMBE_INCLUDE_DIR})
target_link_libraries(mbe_synthesizer version ${LIBMBE_LIBRARY})
add_executable(digitalvoice_filter digitalvoice_filter.c)
target_link_libraries(digitalvoice_filter version)
add_executable(fsk_demodulator fsk_demodulator.c)
target_link_libraries(fsk_demodulator version)
add_executable(pocsag_decoder pocsag_decoder.c)
target_link_libraries(pocsag_decoder version hamming_distance dumphex fec)

if (CMAKE_BUILD_TYPE STREQUAL "Debug")
    add_executable(dmr_quadratic_residue_syndrome_generator dmr/quadratic_residue_syndrome_generator.c)
    target_link_libraries(dmr_quadratic_residue_syndrome_generator fec)
    add_executable(dmr_hamming_16_11_syndrome_generator dmr/hamming_16_11_syndrome_generator.c)
    target_link_libraries(dmr_hamming_16_11_syndrome_generator fec)
    add_executable(dmr_hamming_7_4_syndrome_generator dmr/hamming_7_4_syndrome_generator.c)
    target_link_libraries(dmr_hamming_7_4_syndrome_generator fec)
    add_executable(ysf_golay_24_12_syndrome_generator ysf/golay_24_12_syndrome_generator.c)
    target_link_libraries(ysf_golay_24_12_syndrome_generator fec)
    add_executable(dmr_golay_20_8_syndrome_generator dmr/golay_20_8_syndrome_generator.c)
    target_link_libraries(dmr_golay_20_8_syndrome_generator fec)
    add_executable(dmr_hamming_15_11_syndrome_generator dmr/hamming_15_11_syndrome_generator.c)
    target_link_libraries(dmr_hamming_15_11_syndrome_generator fec)
    add_executable(dmr_hamming_13_9_syndrome_generator dmr/hamming_13_9_syndrome_generator.c)
    target_link_libraries(dmr_hamming_13_9_syndrome_generator fec)
    add_executable(pocsag_bch_31_21_syndrome_generator pocsag/bch_31_21_syndrome_generator.c)
    target_link_libraries(pocsag_bch_31_21_syndrome_generator fec)
endif()

install(TARGETS rrc_filter dc_block gfsk_demodulator dmr_decoder ysf_decoder mbe_synthesizer digitalvoice_filter fsk_demodulator pocsag_decoder DESTINATION bin)

SET(CMAKE_CXX_FLAGS "-O3")
SET(CMAKE_C_FLAGS "-O3")
